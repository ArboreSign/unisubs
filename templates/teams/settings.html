{% extends "teams/base.html" %}
{% load i18n teams_tags paginator doorman media_compressor verbatim_templatetag %}

{% block scripts %}
    {{ block.super }}
    {% include_bundle "js-teams-settings-panel" %}
    <script src="{% url teams:rpc_api %}" type="text/javascript"></script>
{% endblock %}

{% block title %}
    {{ team }} {% trans 'Settings' %} | Universal Subtitles
{% endblock %}

{% block view_content %}
    {% with "settings" as current %}
        {% include "teams/_tabs.html" %}
    {% endwith %}

    <div class="panel-holder view grid_9 alpha">
    <div class="tab panel-projects" style="display:none"></div>
        {% include "teams/_basic_settings.html" %}
    </div>

    <div class="controls grid_3 omega ">
        <ul class="sub-settings-panel"></ul>
        {% include "teams/_actions.html" %}
    </div>

    <script type="text/javascript">
        $(window).load(function(){
            {% include "teams/panel-base.js" %}
            {% include "teams/settings-panel.js" %}
        });
    </script>

<!-- templates -->
<script id="IMAGE_PRELOADER" type="text/html">
  <img class="placeholder" width="256" height1="30" src="{{ STATIC_URL }}images/ajax-loader.gif"/>
</script>

{% comment %}  Whatever is inside the verbatim tag does not run through
django's var subtitution, so the final template is render as it's written bellow.
This is needed, since it's for the js templating
{% endcomment %}

{% verbatim %}

<script id="subMenuItem" type="text/html">
  <li><a href="#">{{label}}</a></li>
</script>

<script id="basicPanel" type="text/html">
    <div class="panel-basic">
        <div id="basic_settings_form">
            <div class="grid_4 alpha">
                <form class="team-settings">
                    <fieldset>
                            <legend>Team Details</legend>

                            <label for="basic_name">Name</label>
                            {% endverbatim %}
                                {% if team|can_rename_team:request.user %}
                                    <input id="basic_name" type="text" name="name" value="" />
                                {% else %}
                                    <input id="basic_name" type="text" name="name" value="" disabled="disabled" />
                                {% endif %}
                            {% verbatim %}

                            <label for="basic_slug">Team URL</label>
                            <input id="basic_slug" type="text" name="slug" disabled="disabled" value="" />
                            <p class="notation">http://universalsubtitles.org/teams/<em>team_slug</em></p>

                            <label for="basic_description">Description</label>
                            <textarea id="basic_description" name="description"></textarea>
                            <p class="notation">All urls will be converted to links.</p>
                        </fieldset>
                </form>
            </div>

            <div class="grid_4 omega">

                <form class="logo" action="{% endverbatim %}{% url teams:upload_logo team.slug %}{% verbatim %}" method="POST">
                    <fieldset>
                        <legend>Display Settings</legend>
                        <label>Logo/Banner</label>
                        {% endverbatim %}{% csrf_token %}
                        {% if team.logo %}
                            <img id="current_logo" src=""/>
                        {% endif %}{% verbatim %}
                        <input type="file" id="basic_picture" name="logo" />
                        <p class="notation">Max 940 x 235</p>
                        <label><input id="basic_visibility" type="checkbox" name="visibility"/> Publicly visible?</label>
                    </fieldset>
                </form>

            </div>
            
            <div class="grid_9 submit">
                <form class="team-settings"><input type="submit" class="submit save" value="Save Changes" name="save" /></form>
            </div>
        </div>
    </div>
</script>

<script id="guidelinesPanel" type="text/html">
    <div class="panel-guidelines">
        <form id="guidelines_messages_form">
            <div class="grid_4 alpha messages">
                <fieldset>
                    <legend>Custom messages</legend>
                    <p class="notation">
                        Customize the messages sent to your users.
                        The text you enter will preceed the default system message.
                    </p>

                    <label for="id_messages_invite">When a member is invited to join the team</label>
                    <textarea id="id_messages_invite" name="messages_invite"></textarea>

                    <label for="id_messages_application">When a member applies to join the team</label>
                    <textarea id="id_messages_application" name="messages_application"></textarea>

                    <label for="id_messages_manager">When a member is given the Manager role</label>
                    <textarea id="id_messages_manager" name="messages_manager"></textarea>

                    <label for="id_messages_admin">When a member is given the Admin role</label>
                    <textarea id="id_messages_admin" name="messages_admin"></textarea>
                </fieldset>
            </div>
            <div class="grid_4 omega guidelines">
                <fieldset>
                    <legend>Guidelines</legend>
                    <p class="notation">
                        Add guidelines to be displayed to your users when completing tasks.
                    </p>

                    <label for="id_guidelines_subtitle">When creating subtitles</label>
                    <textarea id="id_guidelines_subtitle" name="guidelines_subtitle"></textarea>

                    <label for="id_guidelines_translate">When translating</label>
                    <textarea id="id_guidelines_translate" name="guidelines_translate"></textarea>

                    <label for="id_guidelines_review">When reviewing</label>
                    <textarea id="id_guidelines_review" name="guidelines_review"></textarea>
                </fieldset>
            </div>

            <div class="grid_9 submit">
                <input type="submit" class="submit save" value="Save Changes" name="save" />
            </div>
        </form>
    </div>
</script>

<script id="permissionsPanel" type="text/html">
    <div class="panel-permissions">
        <form class="permissions">
            <div class="grid_4 alpha messages">
                <fieldset>
                    <legend>Team Management</legend>
                    <label for="id_membership_policy">How can users join your team?</label>
                    {% endverbatim %}{{ permissions_form.membership_policy }}{% verbatim %}

                    <label for="id_video_policy">Who can add/remove videos?</label>
                    {% endverbatim %}{{ permissions_form.video_policy }}{% verbatim %}

                </fieldset>
                <fieldset>

                    <legend>Subtitling</legend>

                    <label for="id_subtitle_policy">Who can create subtitles?</label>
                    <p class="notation">i.e. transcribe from video and perform time-alignment</p>
                    {% endverbatim %}{{ permissions_form.subtitle_policy }}{% verbatim %}

                    <label for="id_translate_policy">Who can translate subtitles?</label>
                    <p class="notation">i.e. translate text from an original subtitle into a new language</p>
                    {% endverbatim %}{{ permissions_form.translate_policy }}{% verbatim %}

                </fieldset>
            </div>
            <div class="grid_4 omega guidelines">
                <fieldset>
                    <legend>Tasks</legend>
                    <p class="notation">Manage subtitling and translation work for your videos</p>
                    <label for="id_task_assign_policy">Who can create and assign tasks?</label>
                    {% endverbatim %}{{ permissions_form.task_assign_policy }}{% verbatim %}
                    <p class="notation">Specified members will only be able to create/assign tasks they are permitted to complete themselves</p>
                </fieldset>
                <fieldset>
                    <legend>Workflows</legend>
                    <p class="notation">Workflows enable you to add moderation steps and automate tasks</p>
                    <label for="permissions_workflows_enabled"><input type="checkbox" name="workflows_enabled" id="permissions_workflows_enabled"/> Enable workflows</label>
                </fieldset>

                <div class="workflow"></div>
            </div>

            <div class="grid_9 submit">
                <input type="submit" class="submit save" value="Save Changes" name="save" />
            </div>
        </form>
    </div>
</script>

<script id="workflow" type="text/html">
    <fieldset id="workflow">
        <label for="id_autocreate_subtitle">
            {% endverbatim %}{{ workflow_form.autocreate_subtitle }}{% verbatim %}
            Automatically create subtitle tasks
        </label>

        <label for="id_autocreate_translate">
            {% endverbatim %}{{ workflow_form.autocreate_translate }}{% verbatim %}
            Automatically create translation tasks
        </label>

        <label for="id_review_allowed">Review</label>
        {% endverbatim %}{{ workflow_form.review_allowed }}{% verbatim %}

        <label for="id_approve_allowed">Approval</label>
        {% endverbatim %}{{ workflow_form.approve_allowed }}{% verbatim %}

        <input type="submit" class="button submit" value="Save Workflow Changes" name="save" />
    </fieldset>
</script>

<script id="projectPanel" type="text/html">
    <div class="tools group panel-project">
      <a class="button project-add">Add Project</a>
    </div>
    <ul class="projects listing">
    </ul>
</script>

<script id="projectEditPanel" type="text/html">
  <div class="project-edit-panel modal-window-bg">
    <form action="#">
        <div class="grid_4 alpha">
            <fieldset>
              <legend> Change project {{name}}</legend>
              <label for="name">Name</label>
              <input id="basic_name" type="text" name="name" class="clearfix" value="{{name}}"/>

              <label for="name">Description</label>

              <textarea id="basic_description" name="description" class="clearfix" >{{description}}</textarea>
              <input type="hidden" value='{{pk}}' name="pk"/>
              <input type="hidden" value='{{order}}' name="order"/>
              <input type="hidden" value='{{slug}}' name="slug"/>
            </fieldset>
        </div>
        <div class="grid_4 omega">
            <fieldset>
              <legend>Workflows</legend>
              <p class="notation">Moderate this project's subtitles. Will override the team's workflow if exists.</p>
              <label for="workflow_enabled"><input id="basic_workflows_enabled" type="checkbox"  name="workflow_enabled" {{#workflow_enabled}}checked="checked"{{/workflow_enabled}}/> Enable workflows</label>
            </fieldset>
        </div>

        <div class="grid_9 submit">
          <a class="button delete project-delete">Delete</a>
          <a class="button cancel project-cancel">Cancel</a>
          <a class="button save project-save">Save</a>
        </div>
    </form>
  </div>
</script>

<script id="projectListItem" type="text/html">
  <li>
    <span><a href="{{url}}">{{name}}</a>
    <ul class="actions">
      <li>
        <a class="action-edit" href="#">Edit</a>
      </li>
    </ul>
  </li>
</script>

<script id="confirmationDialog" type="text/html">
    <div class="modal-window-bg">
      <h3>{{title}}</h3>
      <div>{{body}}</div>
      <p class="clearfix"></p>
      <button class="red_button small submit_button cancel">{{cancelText}}</button>
      <button class="blue_button small submit_button confirm">{{okText}}</button>
    </div>
</script>

{% endverbatim %}
{% endblock %}
