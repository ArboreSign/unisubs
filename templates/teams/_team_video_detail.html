{% load i18n teams_tags to_json %}

<li class="team_video_listing_{{ search_record.team_video_pk }}">
    <h3>
        <a href="{% url videos:video video_id=search_record.video_id %}">{{ search_record.title|truncatewords:9 }}</a>
        {% if search_record.project_name != "_root" %}
            <span class="descriptor"><a href="{% url teams:project_video_list slug=team.slug,project_slug=search_record.project_slug %}">{{ search_record.project_name }}</a></span>
        {% endif %}
    </h3>

    <p>
        {% if search_record.description %}
            {{ search_record.description|truncatewords:18|urlize }}.
        {% endif %}
    </p>

    <a href="{% url videos:video video_id=search_record.video_id %}" class="thumb"><img src="{{ search_record.thumbnail }}" alt="{{ search_record.title }} thumbnail"></a>

    <ul class="actions">
        <li>
            <h4>
                {% if search_record.video_completed_langs %}
                    <a href="{% url videos:video video_id=search_record.video_id %}" title="View available subtitles">{{ search_record.video_completed_langs|length }} language{{ search_record.video_completed_langs|length|pluralize }}</a>
                {% else %}
                    {% trans "No subtitles yet" %}
                {% endif %}
            </h4>
        </li>
        <li>
            <a href="{% url teams:team_tasks slug=team.slug %}?team_video={{ search_record.team_video_pk }}" title="View open tasks for this video">
                {% if search_record.task_count %}
                    {% blocktrans count counter=search_record.task_count %}
                        1 open task
                    {% plural %}
                    {{ counter }} open tasks
                    {% endblocktrans %}
                {% else %}
                    {% trans "No open tasks" %}
                {% endif %}
            </a>
        </li>
    </ul>

    {% if team|is_team_member:request.user %}
        <ul class="admin-controls">
            {% if search_record.team_video_pk|can_edit_video:request.user %}
                <li>
                    <a href="{% url teams:team_video team_video_pk=search_record.team_video_pk %}" title="Edit this video">Edit</a>
                </li>
            {% endif %}

            {% if search_record|can_create_any_task:request.user %}
                <li>
                    <a href="{% url teams:create_task slug=team.slug team_video_pk=search_record.team_video_pk %}" title="Add a task for this video">+ Task</a>
                </li>
            {% else %}
                <li>
                    <a class="disabled" title="No available tasks to add">+ Task</a>
                </li>
            {% endif %}

            {% if search_record.team_video_pk|can_edit_video:request.user %}
                <li>
                    <form action="{% url teams:remove_video team_video_pk=search_record.team_video_pk %}" method="post" style="display: none;">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ request.path }}" />
                    </form>
                    <a class="remove-video" href="{% url teams:remove_video team_video_pk=search_record.team_video_pk %}" title="Remove this video from the team">Remove</a>
                </li>
            {% endif %}
        </ul>
    {% endif %}

    <script type="text/javascript">
        $('a.team_video_{{ search_record.team_video_pk }}').click(function(){
            unisubs.api.openUnisubsDialogOnsite(
                '{{search_record.video_id}}',
                '{{search_record.video_url}}',
                GLOBAL_WIDGET_SETTINGS
            );
            return false;
        });
    </script>
</li>
